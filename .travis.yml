jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python .multipackage/scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: g2O5rUaWSsVoduwMI1cYMqvyOyOnDHPw6yi2TGBSKzrxfOTpoTq5IVkXIJP7j+iISDZJHhElrZmG9+9gaVqAY9585JlVxcdL4pktp3s0Q9X+tPk/FFFLVr/bw91eiXb8xXExc2OvA9dtffa5RWUebqayHH2mBK/+wOVbL33HL01p33bwdS6BYhMkigGL+S0do1iSiAbo4SAZMUEL7e5HPM6sDz1ACg6ELEHG/ivslnD090jP78dqOXf1R9gr/oVBChugRy3tLqv8DVhTr3hKdV3QIgaRVj3p7D8pmebEahIPOBlBuIIN7LTTjNyuPjZus9+fJnYe2pjNGodTo2D1xcg0k5WU1KEjrRqHi05QcZmQ9LRGNH4s3kbXSiJQeKESs4+lUjWByFc8KrWHSpe8Wunl/or+jum8XUNHsU8gULS37QBDi6UGVO24Fna4CPvGIZXI5QtDJOokyP39tZY2ObaewJRi8NSXftR+VGfiPvTmGr0jxSXyGu9F8Wq06Tn8CKdIl11bGIG2HSmhr1y1+4Ailf9b0Z+rWT9wjHUJWYxDjOOlL7DiCMDXf0oCi4o3rY+bbIi0+YpaHG1FrvAtwshIOVZgdMIryGTwWfvrbQbccKSylsWYXKuUc1kxR/WNPmS0SGxhcsqoaUPQN2WmnXfOcNxzkGVEqNn39UR4D2Y=
    - stage: "Deploy"
      if: tag IS present
      script: python .multipackage/scripts/release_by_name.py $TRAVIS_TAG
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Release to PyPI Index"
      env:
        - secure: oWPGsfONqBnm72xolfspDEx4LUAJCadf1tITU8uqR4YZl2YqdQbTiNdlKwbHl8OoTPEiQJC03qNtkaHtlKTYZOu54L2X+i8kKh1lE8lYky8HoZlPzvbSy/teLDM2Crgd6TZouaI0tduTTug5FaYfKgael0oUQSYfIcI1VesUUMq4Jn+CPjJboZj93aD3yTk/Gj59ThhrLNRPsYFAahKi6UDGBmMAY+VIPC0FibVD4BEnK7LxgLEHeSegLcchXIwYZrLmPreVEY+JVfrJYMj/zpmtuU8dWDTjc0safWHKEawBd4OT4PbBxosRIqNt41oypRyrDawBMrjjiei9Mto8J/l0EV8djsIrS/pHDe1/AdpoYsoQfVH04F0u2vlTDM0rDRndsG/op8Vd2OfZz4/qMv2fMslp9vcUohEY8cqrQbU4Wl0faNgHR+cz8iEeRQp1x6muqn/hrKOiTur9h7y6FExXt3i2OQrdCGuObQPdkaYT9rDqDT+C6MOi0L1TUVCGk8PCRD6xa3+6Wb98QdZxvOwUCHr3bz59pd02AIc5G1S8kC20hN6I/MujroQ7JkNR62J86A1ecUS1N3Hv8889D8uEp1F9+kx1XVJzar37rRPzJYqqb9sAqcv+80b7PmMuweSajuao+ZHR5pNk2gsZJAmyhkiB8QHpAgdpYVgeyrU=
        - secure: Ugj+/FabCoe6pZpin3dWZr+fn+9Owtk7sqdg8X4lLjOzmGx6rMpFCYmEBH411yi2vC5c56LqjRLcJrXNXHTZKKui6RVuahL4piXUx9hoxFcKgPH3JXYxIGx9P3TVb8L0OX8myFwtjZhIle6zx0Y5I3jrQDvSqFVkYZ586XM18vTEmhVpYsF7fuU9gnc1QXueCMgUSiBZu0JINqJIeRBQaLH63tHOCOfAz+9rMl5Vs5omURjCKKlItjQ8pzsrvU4j2xtGrfngVxBh+mPNuDrNFHjGcgKBxab+g5zGa92dipBcvE4bje22W6zfxk14yXoZIgxwH39HhKCWLeXfGHpxQtFwp5jrUr5LR73krKcXcrU7+29bF+efb1RonN8172bB1wrat2b1e3Jy1E4cPjWfHUy1FAzdhwzpjM/9PpjU8Ua891p6JoDhs6tSRvMn6lvNbK29OFAYK69v+Z28zozASP2womqSB8QslyUqYfuJWBjTo2+chMZuen6xBtdx9RxaJMlVgwVXDWI2v2LKn8B0Qg2ppQV95U6nm3a8oelyhoWY8b/E6wMZC1TuCsRlC9NEYqSrKnLPECjbzgcjS/A4wpDFdTlzh4+noBHysbyYyRfkwTHCqWn3yjm27RdwPLsdOLHM8BrQb6xuRWUBPczP7n9ZvzTHJYIcwCuE5AzTuVc=
        - secure: AeCsqN0/nD0YLP/mysT366UxEYWBBiPYC4v5EpjKSXEX1MeiApU49XTvZTq5FXbBdfMn/N+nVMIWzAOHl/QW4tb6UyCvMQoKp84jj/nXbFB6Afg5gNUbbc88wdgBRYweCM3mt5/OwFUygbDzCbHUuSskW57/APZY/v/7i0moIt9hmYZiK0qxdUBuapu6GpsBmjhWCY7MWDA9zNTpKqelLC5xVTO1iRm2YG6ImJB8MO02SgKzf/LG+A5HqTML0OF4bqSZpxrNiFlF2Y/6G4GnhJn7e+CpwCGJI5tBbNRRy4WYba1kx32ROo8/AIqcXRVZ8j4ZrQhYRFxybF5nOlFk0k2oB2gQHS7ZRvXfWTMPcYWE8PSEkurS4WptKVlXR+EqU6elzC96oVkTt/ZaPK4Q3Npbq24MZAn4TBaHtes4N8eE1RbgLbs9aYyUNS2KirvCR7gTYY8A0f1lUkKgbEZMXS3OqVuN9GxkNC8ZVXVQqOcNAdAMd93zf2QmfXuWovv+SDayINDvgPyAPwrGzoNZLsqP6rrl+4o4W0BBCf1i9AD5cBS+c8yFZPn4b9WZRdOF4JMLfXvD7iUPBThj3AFiGlu1O/qelaIS4fOjCSmshPv2swgIhkMdkN2aheE6Tawv6wqXKLaPdxal/YEKyTgMXDt0m2hTa2OsKsnldtUBYQk=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./iotile_analytics_core
- pip install ./iotile_analytics_interactive
- pip install ./iotile_analytics_offline

script:
- python .multipackage/scripts/test_by_name.py iotile_analytics_core
- python .multipackage/scripts/test_by_name.py iotile_analytics_interactive
- python .multipackage/scripts/test_by_name.py iotile_analytics_offline
- python .multipackage/scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: bqoiIoUkYvw5RSwxlJfxcLW+KVt9Rkr/e1kYgMA18sJfYD80E5Dx4O8nv7X0atOQGVIsAh6D99DKnlRnB+l+1nYZaMEW4byycFXSSBbtcN5jzez9DRE1McoO243Oab9sna89PQnk0mZGbz06VDj1zBglGkeMX6hWb4iteSu5QxGAne2itYcST4PwVmORKSuRI6Q3WknfWXKNiRYUx4hQdpHqBG7kanErYdiPCqIAestLGZJFNBG4yplLM8cKBrgM8BBINRNMSuFslfAd1sAKMxwiSaegbxT4ASe9On9pXeXf7T+5z4wghMv1T+mF4O+ihmalGbsjAHzYoIOJDjx1x0XIJTHt+82uBr416rM+YYE0mcrP7CpkOciEdnMgMmR25vNC8ygysHOJ0MyFGCYnHsJkfG2Tmv7HHqEl+rgjPelN4WG4Ib7MKMDee2DLyfhrSiyi7ajg5fADdCnUddgLD2NVDj+Vi9tWzZdnWEKRxc4YhHNtj5kHDHjdcz3tfnbheOoJ9REBqRhu8dgU1CUBOmSmHD7dZoA5QS6C5TW1pp5MUL14Lw/gX6JnaXc6qvKQnTQ0BvOXpPgYfvpfg1wJgJEreAxPQFofB1MPJ+JihGMX8u8ErLTsFW6eepHHJf79NBYxKVTd2eIoZrZjTmNx4ssKVw5ckwWf9yYtjLryIrk=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always